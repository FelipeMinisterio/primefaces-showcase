<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="../templates/ui.xhtml">

    <ui:define name="head">
        <style type="text/css">
            .logo {
                width: 5%
            }
            
            .detail {
                width: 95%;
            }
            
            .detail td {
                font-size: 24px;
            }
            
            .ui-datascroller .ui-datascroller-item {
                border-bottom: 1px solid #A8A8A8;
                padding: 25px 10px;
            }
        </style>
        
        <script type="text/javascript">
//<![CDATA[
/**
 * PrimeFaces DataScroller Widget
 */
PrimeFaces.widget.DataScroller = PrimeFaces.widget.BaseWidget.extend({
    
    init: function(cfg) {
        this._super(cfg);
        this.content = this.jq.children('div.ui-datascroller-content');
        this.list = this.content.children('ul');
        this.loading = false;
        this.cfg.offset = this.cfg.chunkSize;
        
        var win = $(window),
        doc = $(document),
        $this = this;

        this.shouldLoad();

        win.scroll(function () {
            if((win.scrollTop() === (doc.height() - win.height()) && $this.shouldLoad())) {
                $this.load();
            }
        });
    },
    
    load: function() {
        this.loading = true;
        
        var $this = this,
        options = {
            source: this.id,
            process: this.id,
            update: this.id,
            params: [{name: this.id + '_load', value: true},{name: this.id + '_offset', value: this.cfg.offset}],
            onsuccess: function(responseXML) {
                var xmlDoc = $(responseXML.documentElement),
                updates = xmlDoc.find("update");

                for(var i=0; i < updates.length; i++) {
                    var update = updates.eq(i),
                    id = update.attr('id'),
                    content = PrimeFaces.ajax.AjaxUtils.getContent(update);

                    if(id === $this.id) {
                        $this.list.append(content);
                    }
                    else {
                        PrimeFaces.ajax.AjaxUtils.updateElement.call(this, id, content);
                    }
                }

                PrimeFaces.ajax.AjaxUtils.handleResponse.call(this, responseXML);

                return true;
            },
            oncomplete: function() {
                $this.cfg.offset += $this.cfg.chunkSize;
                $this.loading = false;
            }
        };
        
        PrimeFaces.ajax.AjaxRequest(options);
    },
    
    shouldLoad: function() {
        return (!this.loading && ((this.cfg.offset + this.cfg.chunkSize) <= this.cfg.totalSize));
    }
});
//]]>
		</script>
		
	</ui:define>
	
	<ui:define name="content">
		<h1 class="title ui-widget-header ui-corner-all">DataScroller</h1>
		<div class="entry">
			<p>DataScroller displays a collection of data featuring on demand loading using scroll..</p>
            
            			<h3>Source</h3>
			<p:tabView style="margin-bottom:50px">
				<p:tab title="dataScroller.xhtml">
					<pre name="code" class="xml">

					</pre>
				</p:tab>
				
				<p:tab title="TableBean.java">
					<pre name="code" class="java">

					</pre>
				</p:tab>
			</p:tabView>
		
			<h:form id="form">
                
                <p:dataScroller value="#{tableBean.carsLarge}" var="car" chunkSize="10">
                    
                    <f:facet name="header">
                        Scroll Down to Load More Cars
                    </f:facet>
                    
                    <h:panelGrid columns="2" style="width:100%" columnClasses="logo,detail">
                        <p:graphicImage value="/images/cars/#{car.manufacturer}.jpg"/> 

                        <p:outputPanel>
                            <h:panelGrid columns="2">
                                <h:outputText value="Model:" />
                                <h:outputText value="#{car.model}" style="font-weight: bold"/>
                                
                                <h:outputText value="Year:" />
                                <h:outputText value="#{car.year}" style="font-weight: bold"/>
                                
                                <h:outputText value="Color:" />
                                <h:outputText value="#{car.color}" style="font-weight: bold"/>
                            </h:panelGrid>
                        </p:outputPanel>
                    </h:panelGrid>
                </p:dataScroller>
                
			</h:form>
			

		
		</div>
				
	</ui:define>
    
    <ui:define name="footer" />
</ui:composition>